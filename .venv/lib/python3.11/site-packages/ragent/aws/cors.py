from typing import List

from ragent.aws.secrets_manager.envs import get_secret_value_from_secret_manager
from ragent.log_utils import logger


def get_origins() -> List[str]:
    """Get allowed origins from environment variable."""
    try:
        # Get the value of CORS_ORIGIN from the environment variable
        CORS_ORIGIN: str = get_secret_value_from_secret_manager("CORS_ORIGIN")
        logger.info(f"CORS_ORIGIN: {CORS_ORIGIN}")

        # Check if CORS_ORIGIN contains a semicolon
        if CORS_ORIGIN and ";" in CORS_ORIGIN:
            # Split the CORS_ORIGIN string into a list of origins
            origins: List[str] = CORS_ORIGIN.split(";")
            logger.info(f"Origins, Entered if statement: {origins}")
        else:
            # If there's no semicolon or CORS_ORIGIN is None, use default
            origins: List[str] = [CORS_ORIGIN] if CORS_ORIGIN != "*" else ["*"]
            logger.info(f"Origins, Entered else statement: {origins}")
        return origins
    except Exception as e:
        logger.error(f"Error getting CORS origins: {str(e)}")
        return ["*"]  # Default to allow all origins if there's an error
