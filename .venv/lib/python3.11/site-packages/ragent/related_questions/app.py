import logging
from typing import Any

from ragent.chain import generate_related_questions
from ragent.prompts.ragbase import RELATED_QUESTION_PROMPT


async def related_questions(
    llm: Any,
    user_input: str,
    prompt: str = None,
    context: str = "",
    no_of_questions: int = None,
) -> str:
    """
    Generate related questions based on user input and optional context.
    Args:
        llm: The language model to use for generating related questions.
        user_input: The user's input query.
        prompt: The prompt template for generating related questions.
        context: Optional context string to include in the generation.
        no_of_questions: Number of related questions to generate

    Returns:
        A string containing the generated related questions, or an empty string if an error occurs.
    """

    if prompt is None:
        prompt = RELATED_QUESTION_PROMPT

    logger = logging.getLogger("langchain.retrievers.multi_query")
    logger.info("Starting to generate related questions")
    logger.info(f"User input: {user_input}")

    logger.info(f"Context provided: {'Yes' if context else 'No'}")
    logger.info(f"Number of questions to generate: {no_of_questions}")

    try:
        # Generate related questions with context (if provided) and specified number of questions
        response = await generate_related_questions(
            llm=llm,
            source_documents=None,  # Pass None since context is a string
            user_input=user_input,
            prompt=prompt,
            context=context,
            no_of_questions=no_of_questions,
        )
        logger.info("Related questions generated successfully")
        return response

    except Exception as e:
        logger.error(f"Error generating related questions: {str(e)}")
        return ""
