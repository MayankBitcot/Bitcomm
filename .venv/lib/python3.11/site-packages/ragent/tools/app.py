import os

from langchain_community.tools import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate

from ragent.constants import TAVILY_API_KEY
from ragent.prompts.ragbase import TAVILY_PROMPT


def get_tavily_search_tool():
    """
    Initialize and return the Tavily search tool.

    Returns:
        TavilySearchResults: Configured Tavily search tool.
    """
    # Set API key in environment if provided
    os.environ["TAVILY_API_KEY"] = TAVILY_API_KEY

    # Initialize and return Tavily tool
    return TavilySearchResults(
        max_results=5,
        search_depth="advanced",
        include_answer=True,
        include_raw_content=True,
        include_images=True,
    )


def get_tavily_prompt_template(system_prompt: str = TAVILY_PROMPT):
    """
    Create and return a ChatPromptTemplate for Tavily search.

    Args:
        system_prompt (str): The system prompt to use.

    Returns:
        ChatPromptTemplate: Configured prompt template for Tavily.
    """
    return ChatPromptTemplate(
        [
            ("system", system_prompt),
            ("human", "{user_input}"),
            ("placeholder", "{messages}"),
        ]
    )
