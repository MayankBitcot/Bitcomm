from pathlib import Path

from guardrails import GuardrailsAsyncOpenAI, GuardrailTripwireTriggered


class GuardrailProcessor:
    """Simple class to process text with guardrails"""

    def __init__(
        self,
        config_file: str = "config.json",
        model: str = "gpt-4o",
        temperature: float = 0.0,
    ):
        self.config_file = config_file
        self.model = model
        self.temperature = temperature
        self.client = GuardrailsAsyncOpenAI(config=Path(config_file))

    async def process_text(self, user_query: str, instructions: str = None) -> dict:
        """
        Process user query with guardrails

        Args:
            user_query: The text to process
            instructions: Optional custom instructions, uses default if not provided

        Returns:
            dict: Result containing original text, processed text, and guardrail info
        """
        default_instructions = """You are a helpful assistant, your role is to return exact user input as received from the user. You are strictly prohibited from generating response or altering user query"""
        final_instructions = instructions or default_instructions

        try:
            response = await self.client.responses.create(
                model=self.model, input=user_query, instructions=final_instructions
            )

            return response

        except GuardrailTripwireTriggered as exc:
            return exc.guardrail_result.info
        except Exception as e:
            return {"error": f"An error occurred: {e}"}
