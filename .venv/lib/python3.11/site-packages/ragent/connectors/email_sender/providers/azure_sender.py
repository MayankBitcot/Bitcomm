from ragent.connectors.email_sender.base import EmailSender
from ragent.log_utils import logger


class AzureEmailSender(EmailSender):
    def __init__(self, api_key):
        try:
            import sendgrid
            from sendgrid.helpers.mail import Mail
        except ImportError:
            raise ImportError(
                "sendgrid is not installed. Please install it for Azure email sending."
            )

        self.sendgrid = sendgrid
        self.Mail = Mail
        self.sg = sendgrid.SendGridAPIClient(api_key)

    def _send(self, from_email: str, to_email: str, email_body: str, subject: str):
        try:
            message = self.Mail(
                from_email=from_email,
                to_emails=to_email,
                subject=subject,
                plain_text_content=email_body,
            )
            self.sg.send(message)
            return True
        except Exception as e:
            logger.error(f"Failed to send email: {str(e)}")
            return False
