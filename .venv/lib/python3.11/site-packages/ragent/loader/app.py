"""
Document loader implementations for different file formats.
"""
from typing import Dict, List, Union

from langchain_core.document_loaders.base import BaseLoader

from ragent.loader.utils import InvalidLoaderType, get_loader_instance_from_config
from ragent.log_utils import logger


def load_document(
    file_path: str,
    source_column: Union[str, None] = None,
    loader_config: Union[str, BaseLoader, Dict, None] = None,
    loader_params: Dict = None,
) -> List:
    """
    Loads documents of different formats.

    Args:
        file_path: Path to the file to be loaded
        source_column: Column name to use as source (for CSV files)
        loader_config: Either a loader name (str), a loader instance (BaseLoader),
               or a dictionary mapping file extensions to loader classes.
               If None, will auto-detect based on file extension
        loader_params: Additional parameters to pass to the loader

    Returns:
        List of loaded documents

    Raises:
        InvalidFileFormat: If the file format is not supported
        InvalidLoaderType: If the loader type is not supported
    """
    if loader_params is None:
        loader_params = {}

    try:
        # Get the appropriate loader instance based on configuration
        loader_instance = get_loader_instance_from_config(
            file_path, source_column, loader_config, loader_params
        )

        # Load the documents
        logger.info(f"Loading documents using {loader_instance.__class__.__name__}")
        return loader_instance.load()

    except InvalidLoaderType as e:
        error_message = f"Invalid loader type: {e}"
        raise ValueError(error_message)

    except Exception as e:
        error_message = f"Failed to load document: {e}"
        raise ValueError(error_message)
